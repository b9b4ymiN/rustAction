name: Scheduled run
on:
  schedule:
    - cron: "0 4 * * 1-5"
  workflow_dispatch:
jobs:
  run:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Bangkok
    steps:
      - uses: actions/checkout@v4
      - name: Create .env
        run: |
          cat <<'EOF' > .env
          API_URL=${{ secrets.API_URL }}
          TOKEN=${{ secrets.TOKEN }}
          YOUTUBE_API_KEY=${{ secrets.YOUTUBE_API_KEY }}
          SUPABASE_API_KEY=${{ secrets.SUPABASE_API_KEY }}
          KSFORWORD_CHANNEL_ID=${{ secrets.KSFORWORD_CHANNEL_ID }}
          USE_MOCK_DATA=${{ secrets.USE_MOCK_DATA }}
          MY_AI_API_URL=${{ secrets.MY_AI_API_URL }}
          DISCORD_KS_BOT_TOKEN=${{ secrets.DISCORD_KS_BOT_TOKEN }}
          EOF
      - name: Install Rust toolchain
        uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable
          override: true
      - name: Build
        run: cargo build --release
      - name: Run
        run: cargo run --release